<%- include('partials/header') %>

<h2 class="mb-2 text-center fw-bold">Calendario de citas</h2>

<%
  const nombresMes = [
    'Enero','Febrero','Marzo','Abril','Mayo','Junio',
    'Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'
  ];
%>

<!-- Encabezado: tÃ­tulo y botones -->
<div class="text-center mb-3">
  
  <h4 class="fw-bold text-uppercase mb-1" style="letter-spacing:0.5px;">
  <%= nombresMes[month - 1] %> <%= year %>
</h4>

<% 
  let totalMes = 0;
  if (typeof citaCounts !== 'undefined') {
    for (const fecha in citaCounts) {
      totalMes += citaCounts[fecha];
    }
  }
%>

<p class="text-muted fw-semibold mb-3">
  ðŸ“… Total de citas en el mes: 
  <span class="text-primary"><%= totalMes %></span>
</p>

  <div class="d-flex justify-content-between align-items-center flex-nowrap gap-2">
    <!-- Mes anterior -->
    <form method="get" action="/mes" class="flex-fill text-start">
      <input type="hidden" name="year" value="<%= month === 1 ? year - 1 : year %>">
      <input type="hidden" name="month" value="<%= month === 1 ? 12 : month - 1 %>">
      <button class="btn btn-outline-secondary px-3 py-2 fw-semibold rounded-pill w-100" type="submit">
        &laquo; Mes anterior
      </button>
    </form>

    <!-- Mes siguiente -->
    <form method="get" action="/mes" class="flex-fill text-end">
      <input type="hidden" name="year" value="<%= month === 12 ? year + 1 : year %>">
      <input type="hidden" name="month" value="<%= month === 12 ? 1 : month + 1 %>">
      <button class="btn btn-outline-secondary px-3 py-2 fw-semibold rounded-pill w-100" type="submit">
        Mes siguiente &raquo;
      </button>
    </form>
  </div>
</div>

<!-- Calendario -->
<div class="table-responsive">
  <table class="table table-bordered text-center align-middle calendar-table">
    <thead class="table-light">
      <tr>
        <th>Dom</th>
        <th>Lun</th>
        <th>Mar</th>
        <th>MiÃ©</th>
        <th>Jue</th>
        <th>Vie</th>
        <th>SÃ¡b</th>
      </tr>
    </thead>
    <tbody>
      <% weeks.forEach(week => { %>
        <tr>
          <% week.forEach(day => { %>
            <% if (!day) { %>
              <!-- Celda vacÃ­a: se deja visible para no desalinear columnas -->
              <td class="bg-light">&nbsp;</td>
            <% } else { %>
              <td class="p-1 p-md-2">
                <a href="/citas?fecha=<%= day.isoDate %>"
                   class="btn btn-outline-primary w-100 py-2 py-md-3 rounded-3 d-flex flex-column align-items-center justify-content-center shadow-sm"
                   style="min-height:70px; font-weight:500;">
                  <span class="fs-6"><%= day.day %></span>
                  <% if (typeof citaCounts !== 'undefined' && citaCounts[day.isoDate] > 0) { %>
                    <span class="badge bg-danger mt-1 px-2 py-1">
                      <%= citaCounts[day.isoDate] %> cita<%= citaCounts[day.isoDate] > 1 ? 's' : '' %>
                    </span>
                  <% } %>
                </a>
              </td>
            <% } %>
          <% }) %>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>

<%- include('partials/footer') %>
